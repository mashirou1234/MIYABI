# MIYABI エンジン設計思想

## 1. コアコンセプト：「コード駆動の美学」 (Code-as-Scene)

MIYABIは、「宮大工」の精神に基づくC++/Rustハイブリッド3Dゲームエンジンです。その核となる思想は「コード駆動 (Code-as-Scene)」です。これは、ゲームの世界、オブジェクト、ロジックそのものを、精緻に作られた工芸品のような、エレガントで明確なコードによって定義するという考え方です。

- **宣言的かつイミュータブルなシーン:** ゲームシーンはRustコード内で宣言的に構築されます。シーンの定義コードそのものが、信頼できる唯一の情報源（Source of Truth）となります。
- **データ駆動型アーキテクチャ:** データ（コンポーネント）とロジック（システム）を分離する、エンティティ・コンポーネント・システム（ECS）パターンを主軸としたデータ駆動型のアプローチを採用します。
- **「頭脳」としてのRust:** Rustは、シーンのロジック、状態管理、ゲーム世界の高レベルな定義を担当します。その安全性とモダンな機能は、堅牢なシステムを構築するのに理想的です。
- **「筋肉」としてのC++:** C++は、グラフィックスAPI（OpenGL/Vulkan等）との連携や、生データのレンダリング処理など、パフォーマンスが最重要となる低レベルなタスクを管理します。

## 2. アーキテクチャ目標

- **明確なC++/Rust境界:** C++とRust間のインターフェース（ブリッジ）は、最小限かつ明確に定義されている必要があります。安全で明確な相互運用性のために`cxx`を使用します。
- **パフォーマンス:** レンダリングのようなクリティカルなループはC++側で最適化し、Rust側で準備されたデータを効率的に処理します。
- **ホットリロード（将来的な目標）:** 「Code-as-Scene」のコンセプトは、強力な開発ワークフローへの扉を開きます。例えば、C++アプリケーションの実行中に、Rustのロジッククレートを動的に再コンパイルし、リロードする、といった機能です。

## 3. 初期実装計画

「Code-as-Scene」のコンセプトを具現化するため、以下のステップから着手します。

1.  **Rustでのコア要素の定義:**
    -   `Entity`: ワールド内のオブジェクトを一意に識別するためのID。
    -   `Component`: エンティティに関連付けられるデータ。最初に実装するコンポーネントは、位置・回転・スケールを保持する `Transform` とします。
2.  **シーン/ワールド構造の作成:**
    -   Rust側で、すべてのエンティティとコンポーネントを保持するためのコンテナ。
3.  **レンダリングデータ用ブリッジの構築:**
    -   C++のレンダラーが、Rustのワールドからレンダリング対象オブジェクトのリスト（例：`Transform`のリスト）を要求できるように、C++/Rustブリッジを拡張します。
4.  **C++レンダラーの更新:**
    -   C++のメインループは、フレーム毎にRustからTransformのリストを取得し、それぞれのオブジェクトに対してプリミティブ（例：三角形）を描画します。
