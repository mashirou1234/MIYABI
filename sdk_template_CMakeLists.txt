cmake_minimum_required(VERSION 3.15)
project(MyMiyabiGame CXX C)

# --- Setup C++ Standard ---
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED TRUE)
set(CMAKE_CXX_EXTENSIONS OFF)
if(MSVC)
    add_compile_options(/Zc:__cplusplus)
endif()

# --- Find Dependencies ---
# You need to have glfw3 and freetype installed on your system
find_package(glfw3 3.3 REQUIRED)
find_package(OpenGL REQUIRED)
find_package(Freetype REQUIRED)

# --- Define MIYABI SDK Paths ---
# Assumes the SDK is placed in a subdirectory named "miyabi_sdk"
set(MIYABI_SDK_PATH ${CMAKE_CURRENT_SOURCE_DIR}/miyabi_sdk)
include_directories(${MIYABI_SDK_PATH}/include)
link_directories(${MIYABI_SDK_PATH}/lib)

# --- Add Your Game Executable ---
add_executable(my_game
    src/main.cpp
    # Add your other source files here
)

# --- Link against MIYABI and other libraries ---
target_link_libraries(my_game PRIVATE
    # Link the game logic dylib
    sample_game

    # Link the static engine libraries
    miyabi_logic
    miyabi_cxxbridge

    # Link system dependencies
    glfw
    OpenGL::GL
    Freetype::Freetype
)

# --- Post-build command to copy the dylib ---
add_custom_command(TARGET my_game POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E copy
    "${MIYABI_SDK_PATH}/lib/libsample_game.dylib"
    $<TARGET_FILE_DIR:my_game>
    COMMENT "Copying MIYABI dylib to executable directory"
)

# Set rpath for macOS/Linux to find the dylib
set_target_properties(my_game PROPERTIES
    BUILD_WITH_INSTALL_RPATH TRUE
    INSTALL_RPATH "@executable_path"
)
