cmake_minimum_required(VERSION 3.15)

if(APPLE AND "${CMAKE_OSX_DEPLOYMENT_TARGET}" STREQUAL "")
    execute_process(
        COMMAND xcrun --sdk macosx --show-sdk-version
        OUTPUT_VARIABLE MIYABI_MACOS_SDK_VERSION
        OUTPUT_STRIP_TRAILING_WHITESPACE
        ERROR_QUIET
    )
    if(MIYABI_MACOS_SDK_VERSION)
        set(CMAKE_OSX_DEPLOYMENT_TARGET "${MIYABI_MACOS_SDK_VERSION}" CACHE STRING "macOS deployment target" FORCE)
    endif()
endif()

project(MyMiyabiGame CXX C)

# --- Setup C++ Standard ---
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED TRUE)
set(CMAKE_CXX_EXTENSIONS OFF)
if(MSVC)
    add_compile_options(/Zc:__cplusplus)
endif()

# --- Define MIYABI SDK Path ---
# Assumes the SDK is placed in a subdirectory named "miyabi_sdk"
set(MIYABI_SDK_PATH "${CMAKE_CURRENT_SOURCE_DIR}/miyabi_sdk")
list(PREPEND CMAKE_PREFIX_PATH "${MIYABI_SDK_PATH}")

# --- Find MIYABI package config ---
find_package(MIYABI 0.1 CONFIG REQUIRED)

# --- Add Your Game Executable ---
add_executable(my_game
    src/main.cpp
    # Add your other source files here
)

# --- Consume MIYABI SDK ---
target_link_libraries(my_game PRIVATE MIYABI::SDK)

if(APPLE)
    target_link_options(my_game PRIVATE "LINKER:-no_warn_duplicate_libraries")
endif()
